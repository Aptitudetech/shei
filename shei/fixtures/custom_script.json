[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2019-09-03 10:31:19.626553", 
  "name": "Customer-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Customer\", \"refresh\", function(){\n    cur_frm.add_custom_button(\"Sales History\", function(){\n        frappe.route_options = {'customer': cur_frm.doc.name};\n        frappe.set_route(\"List\", \"Sales History\");\n    });\n});\n\nfrappe.ui.form.on(\"Customer\", \"default_currency\", function(frm, cdt, cdn) {\n\tif(frm.doc.default_currency == \"USD\") {\n\t\tfrm.doc.accounts = [];\n\t\tvar row = frappe.model.add_child(cur_frm.doc, \"Party Account\", \"accounts\");\n\t\trow.company = \"Systeme Huntingdon Inc\";\n\t\trow.account = \"12150 COMPTES CLIENTS US (ERP) - SHI\";\t\t\t\n\t} else {\n\t\tfrm.doc.accounts = [];\n\t}\n\trefresh_field(\"accounts\");\n});\n\n$.extend(erpnext.utils, {\n        set_party_dashboard_indicators: function(frm){\n                if (frm.doc.__onload && frm.doc.__onload.dashboard_info){\n                        var info = frm.doc.__onload.dashboard_info;\n                        frm.dashboard.add_indicator(__('Last Year Billing: {0}',\n                                [format_currency(info.billing_last_year, info.currency)]), 'blue')\n\t\t\tfrm.dashboard.add_indicator(__('This Year Billing: {0}',\n                                [format_currency(info.billing_this_year, info.currency)]), 'blue')\n                        frm.dashboard.add_indicator(__('Total Unpaid: {0}',\n                                [format_currency(info.total_unpaid, info.currency)]),\n                                info.total_unpaid ? 'orange': 'green');\n                }\n        }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Quotation", 
  "modified": "2019-11-07 11:43:34.668986", 
  "name": "Quotation-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on('Price Configurator Item', {\n\tbefore_panel_list_remove: function(frm, cdt, cdn) {\n   \t    var deleted_row = frappe.get_doc(cdt, cdn);\n\t    var filtered = cur_frm.doc.items.filter(elem => elem['reference_panel'] == deleted_row['panel_id']);\n\t    filtered.forEach(function(element) {\n\t\tfrappe.model.remove_from_locals('Quotation Item', element.name);\n\t    });\n\t    refresh_field(\"items\");\n\t}\n});\nfrappe.ui.form.on('Quotation', {\n\tcustomer_deposit: function(frm, cdt, cdn) {\n\t\tif(frm.doc.customer_deposit){\n\t\t\tfrm.set_df_property('project', 'reqd', 1);\n\t\t}\n       \t \telse{\n\t\t\tfrm.set_df_property('project', 'reqd', 0);\n\t\t}\n\n\t}\n});\n\nfrappe.ui.form.on('Quotation', {\n\ttotal_av_nuts: function(frm, cdt, cdn) {\n\tvar d = locals[cdt][cdn];\n        if (!d.total_av_nuts) return;\n   \t    frappe.model.set_value(cdt, cdn, \"total_tools\", 1);\n\t    refresh_field(\"total_tools\");\n\t}\n});\n\nfrappe.ui.form.on('Price Configurator Item', {\n    aluminum_item: function(frm, cdt, cdn){\n        var d = locals[cdt][cdn];\n        if (!d.aluminum_item) return;\n\tif(d.panel_id == null || d.panel_id.value.length == 0){\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.set_panel_uuid\",\n\t\t\targs:{},\n        \t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"panel_id\", r.message);\n\t\t\t}\n      \t\t})\n\t}\n    }\n});\n\nfrappe.ui.form.on(\"Quotation Item\", \"item_code\", function(frm, cdt, cdn) {\n\tvar ct = locals[cdt][cdn];\n\tsetTimeout(function(){\n\t\tfrappe.call({\n\t\t\tmethod: \"multilingual_extension.item_description.fetch_item_description\",\n\t\t\targs:{\n\t\t\t\tparty_name: frm.doc.party_name,\n\t\t\t\tquotation_to: frm.doc.quotation_to,\n\t\t\t\titem_code: ct.item_code,\n\t\t\t\t},\n        \tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"description\", r.message);\n\t\t\t}\n      \t})\n\t}, 1000);\n});\nfrappe.ui.form.on(cur_frm.doctype, {\n    display_lost_reason: function(frm){\n        let dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Set as Lost\"),\n\t\t\tfields: [\n                                {\"fieldname\": 'lost_reason', 'fieldtype': 'Link',  'options': 'Lost Reason', 'reqd': 1},\n\t\t\t\t{'fieldname': 'other_reason', fieldtype: 'Small Text', label: __('Other Reason'), 'depends_on': \"eval:doc.lost_reason === 'RL0008'\"}\n\t\t\t],\n\t\t\tprimary_action: function() {\n\t\t\t\tvar values = dialog.get_values();\n\t\t\t\tlet reason_description = frappe.db.get_value(\"Lost Reason\", values[\"lost_reason\"], 'lost_reason');\n\t\t\t\t\n\t\t\t\treason_description.then(function(value){\n\t\t\t\t\tlet lost_reason = value['message']['lost_reason']\n\t\t\t\t\tlet full_reason = lost_reason;\n\t\t\t\t\tif(values[\"lost_reason\"] == 'RL0008'){\n\t\t\t\t\t\tif(values[\"other_reason\"] == null ){\n\t\t\t\t\t\t\tfrappe.throw(\"You must write a reason before proceeding\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfull_reason = full_reason + \" - \" + values[\"other_reason\"];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfrm.call({\n\t\t\t\t\t\tmethod: 'declare_order_lost',\n\t\t\t\t\t\tdoc: frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'reason': full_reason\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\trefresh_field(\"quote_lost_reason\");\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Declare Lost')\n\t\t});\n\n\t\tdialog.show();\n\t\tdialog.get_input('lost_reason').on('awesomplete-selectcomplete', function(e){\n\t\t\tsetTimeout(function(){\n        \t\t\tdialog.refresh();\n    \t\t\t}, 500);\n\t\t});\n    }\n});\n\n//Will overwrite the QuotationController - used to change 'Set as lost' button behavior\nerpnext.selling.CustomQuotationController = erpnext.selling.QuotationController.extend({\n    refresh: function(doc, dt, dn) {\n\t\tthis._super(doc, dt, dn);\n\t\t//the button should only be available if the quote is 'Submit'\n\t\tif(doc.docstatus == 1 && doc.status!=='Lost') {\n\t\t\tif(doc.status!==\"Ordered\") {\n\t\t\t\tthis.frm.remove_custom_button(__('Set as Lost'));\n\t\t\t\tthis.frm.add_custom_button(__('Set as Lost'), () => {\n\t\t\t\t\tthis.frm.trigger('display_lost_reason');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\ncur_frm.script_manager.make(erpnext.selling.CustomQuotationController);\n\n\nfrappe.ui.form.on(\"Quotation\", \"customer_deposit\", function(frm, cdt, cdn) {\n\tif(frm.doc.customer_deposit == 1)\n\t{\n\t\tfrappe.model.set_value(cdt, cdn, \"naming_series\", \"PFI-\");\n\t}\n\telse\n\t{\n\t\tfrappe.model.set_value(cdt, cdn, \"naming_series\", \"QTN-\");\n\t}\n});\n\nfrappe.ui.form.on(\"Quotation\", \"refresh\", function(frm, cdt, cdn) {\n\tfrappe.call({\n\t\tmethod: \"shei.sheipy.set_price_configurator_item_selects\",\n\t\targs: {\n\t\t\tdt: 'Price Configurator Item',\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tvar back = frappe.meta.get_docfield(\"Price Configurator Item\",\"back\", cur_frm.doc.name);\n\t\t\tback.options = r['message'][0]['backs'];\n\t\t\tvar cut = frappe.meta.get_docfield(\"Price Configurator Item\",\"cut\", cur_frm.doc.name);\n\t\t\tcut.options = r['message'][0]['cuts'];\n\t\t\tvar thickness = frappe.meta.get_docfield(\"Price Configurator Item\",\"thickness\", cur_frm.doc.name);\n\t\t\tthickness.options = r['message'][0]['thickness'];\n      \t\t}\n\t});\n\n\tif(frm.doc.quotation_mode == 'Price Configurator'){\n\t\tfrm.set_df_property('items', 'reqd', 0);\n\t\tfrm.set_df_property('measurement', 'reqd', 1);\n\t}\n        else{\n\t\tfrm.set_df_property('items', 'reqd', 1);\n\t\tfrm.set_df_property('measurement', 'reqd', 0);\n\t}\n\n        frm.add_custom_button(__(\"Update Item Description\"), function() {\n\t\tfrappe.call({\n\t\t\tmethod: \"multilingual_extension.item_description.update_item_description\",\n\t\t\targs: {\n\t\t\t\tcustomer: frm.doc.party_name,\n\t\t\t\tdocType: \"Quotation\",\n\t\t\t\tdocName: frm.doc.name,\n\t\t\t},\n\t    \t\tcallback: function(r) {\n\t\t\t\tcur_frm.reload_doc();\n      \t\t\t}\n\t\t})\n\t});\n});\n\n\n\nfrappe.ui.form.on(\"Quotation\", \"party_name\", function(frm, cdt, cdn) {\n\t\tfrappe.call({\n\t\t\tmethod: \"multilingual_extension.get_terms_and_conditions.get_terms_and_conditions\",\n\t\t\targs:{\n\t\t\t\tparty_name: frm.doc.party_name,\n\t\t\t\tquotation_to: frm.doc.quotation_to\n\t\t\t\t},\n            \tcallback: function(r) {\n\t\t\tif (r.message != \" \") {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"tc_name\", r.message);\n\t\t\t}\n        \t    }\n\t});\n});\n\n//frappe.ui.form.on(\"Quotation\", \"validate\", function(frm, cdt, cdn){\n//\tif (frm.doc.customer_deposit && !frm.doc.project) {\n//\t\tmsgprint(__(\"Project is mandatory when Customer Deposit is selected\"));\n//\t\tvalidated = false;\n//\t}\n//});\n\nfrappe.ui.form.on(\"Quotation\", \"on_submit\", function(frm, cdt, cdn){\n\tif (frm.doc.customer_deposit && frm.doc.project) {\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.set_project_pfi\",\n\t\t\targs:{\n\t\t\t\tpfi: frm.doc.name,\n\t\t\t\taction: \"add\"\n\t\t\t},\n\t            \tcallback: function(r) {\n\t        \t}\n\t\t});\n\t}\n\tif (frm.doc.customer_deposit && !frm.doc.project) {\n\t\tfrappe.throw(__(\"Project is mandatory when Customer Deposit is selected\"));\n\t}\n});\n\nfrappe.ui.form.on(\"Quotation\", \"after_cancel\", function(frm, cdt, cdn){\n\tif (frm.doc.customer_deposit && frm.doc.project) {\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.set_project_pfi\",\n\t\t\targs:{\n\t\t\t\tpfi: frm.doc.name,\n\t\t\t\taction: \"remove\"\n\t\t\t},\n\t            \tcallback: function(r) {\n\t        \t}\n\t\t});\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2017-10-03 11:12:37.768523", 
  "name": "Sales Invoice-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm, cdt, cdn) {\n        frm.add_custom_button(__(\"Update Item Description\"), function() {\n\t\tfrappe.call({\n\t\t\tmethod: \"multilingual_extension.item_description.update_item_description\",\n\t\t\targs: {\n\t\t\t\tcustomer: frm.doc.customer,\n\t\t\t\tdocType: \"Sales Invoice\",\n\t\t\t\tdocName: frm.doc.name,\n\t\t\t},\n\t    \t\tcallback: function(r) {\n\t\t\t\tcur_frm.reload_doc();\n      \t\t\t}\n\t\t})\n\t});\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"customer\", function(frm, cdt, cdn) {\n\tfrappe.db.get_value(\"Customer\", frm.doc.customer, \"tc_name\", function(r){\n\t\tif(r.tc_name) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tc_name\", r.tc_name);\t\t\t\n\t\t}\n\t});\n\trefresh_field(\"tc_name\");\n});\n\n//frappe.ui.form.on(\"Sales Invoice Item\", \"item_code\", function(frm, cdt, cdn) {\n//\tct = locals[cdt][cdn]\n//\tfrappe.after_ajax(function() {\n//\t\tfrappe.call({\n//\t\t\tmethod: \"multilingual_extension.item_description.fetch_item_description\",\n//\t\t\targs:{\n//\t\t\t\tcustomer_code: frm.doc.customer,\n//\t\t\t\titem_code: ct.item_code,\n//\t\t\t\t},\n//            \tcallback: function(r) {\n//\t\t\tfrappe.model.set_value(cdt, cdn, \"description\", r.message);\n//        \t    }\n//        \t})\n//\t});\n//});\n\n//frappe.ui.form.on(\"Sales Invoice\", \"customer\", function(frm, cdt, cdn) {\n//\t\tfrappe.call({\n//\t\t\tmethod: \"multilingual_extension.get_terms_and_conditions.get_terms_and_conditions\",\n//\t\t\targs:{\n//\t\t\t\tcustomer_code: frm.doc.customer\n//\t\t\t\t},\n//            \tcallback: function(r) {\n//\t\t\tif (r.message != \" \") {\n//\t\t\t\tfrappe.model.set_value(cdt, cdn, \"tc_name\", r.message);\n//\t\t\t}\n//        \t    }\n//\t});\n//});\n\n\nfrappe.ui.form.on(\"Sales Invoice\", \"get_credit_notes\", function(frm, cdt, cdn){\n    if (frm.doc.customer){\n\t\treturn frm.call({\n\t\t\t\"method\": \"shei.events.get_credit_notes\",\n\t\t\t\"args\": {\n\t\t\t\t\"doctype\": frm.doctype,\n\t\t\t\t\"party_type\": \"customer\",\n\t\t\t\t\"party_name\": frm.doc.customer\n\t\t\t},\n\t\t\t\"callback\": function(res){\n\t\t\t\tif (res && res.message){\n\t\t\t\t\tfrm.clear_table('credits');\n\t\t\t\t\tvar pending_amount = frm.doc.outstanding_amount, credits = 0.0;\n\t\t\t\t\tres.message.forEach(function(row){\n\t\t\t\t\t\tvar d = frm.add_child('credits', row);\n\t\t\t\t\t\tif (d.allocated_amount > pending_amount){\n\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name,\n\t\t\t\t\t\t\t\t'allocated_amount', pending_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpending_amount - d.allocated_amount;\n\t\t\t\t\t\tcredits += d.allocated_amount;\n\t\t\t\t\t});\n\t\t\t\t\tfrm.refresh_field(\"credits\");\n\t\t\t\t\tfrm.set_value(\"total_credits\", credits);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"on_submit\", function(frm, cdt, cdn){\n    frm.reload_doc();\n});\n\nfrappe.ui.form.on(\"Sales Invoice Credit Notes\", \"credits_remove\", function(frm, cdt, cdn){\n    frm.doc.total_credits = 0.0;\n    frm.doc.credits.forEach(function(row){\n      frm.doc.total_credits += row.allocated_amount;\n    });\n    frm.refresh_field(\"total_credits\");\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Payment Entry", 
  "modified": "2017-05-18 11:32:00.447638", 
  "name": "Payment Entry-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Payment Entry\", \"refresh\", function(frm, cdt, cdn) {\n        frm.add_custom_button(__(\"Reserve cheque number\"), function() {\n\t\tif(frm.doc.mode_of_payment == \"Cheque CDN\" || frm.doc.mode_of_payment == \"Cheque USD\"){\t\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"shei.advance_payment.get_cheque_series\",\n\t\t\t\targs: {\n\t\t\t\t\taccount: frm.doc.paid_from,\n\t\t\t\t},\n        \t    \t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"reference_no\", r.message);\n\t\t\t\t\t//frm.save()\n\t\t\t\t\t//cur_frm.reload_doc();\n        \t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmsgprint(\"You must select 'cheque' as a mode of payment to use this button\");\n\t\t}\n\t});\n\t\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Project", 
  "modified": "2019-11-01 13:46:27.691641", 
  "name": "Project-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on('Project', {\n    update_task_order: function(frm) {\n        var tasks = cur_frm.doc.tasks;\n\ttasks.forEach(function(element) {\n\t\telement.task_order = element.idx;\n        });\n\tfrappe.msgprint(\"Please save the document to apply the changes\");\n    } \n});\n\nfrappe.ui.form.on('Project Task', {\n    status: function(frm, cdt, cdn){\n        var d = locals[cdt][cdn];\n        if (!d.status) return;\n\tif(d.status == \"Closed\"){\n\t        frappe.model.set_value(cdt, cdn, 'end_date', frappe.datetime.get_today());\n\t}\n    }\n});\n\nfrappe.ui.form.on('Project', {\n    date_ready_for_production: function(frm, cdt, cdn){\n        if (!frm.doc.date_ready_for_production) return;\n\tif(!frm.doc.expected_end_date){\n\t\tvar exp_end_date = frappe.datetime.add_days(frm.doc.date_ready_for_production, 42)\n\t        frappe.model.set_value(cdt, cdn, 'expected_end_date', exp_end_date);\n\t}\n    }\n});\n\nfrappe.ui.form.on('Crate Information', {\n    crate_gross_weight: function(frm, cdt, cdn){\n        var d = locals[cdt][cdn];\n        if (!d.crate_gross_weight) return;\n        frappe.model.set_value(cdt, cdn, 'crate_net_weight', d.crate_gross_weight - 100);\n    }\n});\nfrappe.ui.form.on(\"Project\", \"onload\", function(frm, cdt, cdn){\n\tfrappe.call({\n\t\tmethod: \"shei.sheipy.on_project_onload\",\n\t\targs:{\n\t\t\tproject_name: frm.doc.name,\n\t\t},\n            \tcallback: function(r) {\n\t\t\tfrm.doc.project_amount_from_so = r.message;\n                        frm.refresh_field(\"project_amount_from_so\");\n                        frm.refresh_field(\"tasks\");\n                        frm.doc.__unsaved = false;\n                        frm.toolbar.refresh();\n        \t}\n\t});\n});\n\nfrappe.ui.form.on(\"Project\", \"customer\", function(frm, cdt, cdn) {\n\tif (frm.doc.customer) {\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.get_sales_person_from_customer\",\n\t\t\targs:{\n\t\t\t\tdt: cdt,\n\t\t\t\tcustomer_name: frm.doc.customer,\n\t\t\t\tproject: frm.doc.name,\n\t\t\t},\n        \t    \tcallback: function(r) {\n        \t\t}\n\t        });\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.change_project_name\",\n\t\t\targs:{\n\t\t\t\tdt: cdt,\n\t\t\t\tproject_name: frm.doc.name,\n\t\t\t\tcustomer_name: frm.doc.customer,\n\t\t\t},\n        \t    \tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Project\", r.message);\n\t\t\t\t}\n        \t\t}\n\t        });\n\t}\n});\n\nfrappe.ui.form.on(\"Project\", \"refresh\", function(frm, cdt, cdn) {\n\tif(frappe.user.has_role(['System Manager'])){\n//\t        frm.add_custom_button(__(\"Update Template Project\"), function() {\n//\t\t\tfrappe.call({\n//\t\t\t\tmethod: \"shei.sheipy.update_template_project\",\n//\t\t\t\targs: {\n//\t\t\t\t},\n//        \t    \t\tcallback: function(r) {\n//        \t\t\t}\n//\t\t\t});\n//\t\tfrm.refresh_field(\"project_amount_from_so\");\n//\t\t});\n//\t        frm.add_custom_button(__(\"Update Project Amount from SO\"), function() {\n//\t\t\tfrappe.call({\n//\t\t\t\tmethod: \"shei.sheipy.set_project_so\",\n//\t\t\t\targs: {\n//\t\t\t\t},\n//        \t    \t\tcallback: function(r) {\n//        \t\t\t}\n//\t\t\t});\n//\t\tfrm.refresh_field(\"project_amount_from_so\");\n//\t\t});\n//\t        frm.add_custom_button(__(\"Update Customer Deposit\"), function() {\n//\t\t\tfrappe.call({\n//\t\t\t\tmethod: \"shei.sheipy.set_project_customer_deposit\",\n//\t\t\t\targs: {\n//\t\t\t\t\tproject_name: \"all\",\n//\t\t\t\t},\n//        \t    \t\tcallback: function(r) {\n//        \t\t\t}\n//\t\t\t});\n//\t\tfrm.refresh();\n//\t\t});\n\t};\n//\tfrm.add_custom_button(__(\"Get Customer Deposit\"), function() {\n//\t\tfrappe.call({\n//\t\t\tmethod: \"shei.advance_payment.get_project_deposit\",\n//\t\t\targs:{\n//\t\t\t\tproject_name: frm.doc.name,\n//\t\t\t},\n//\t            \tcallback: function(r) {\n//\t\t\t\tcur_frm.reload_doc();\n//\t        \t}\n//\t\t});\n//\t});\n\tif (frm.doc.sub_type) {\n\t        frm.add_custom_button(__(\"Get Tasks from template\"), function() {\n\t\t\tfrappe.call({\n                        \t'method': 'shei.shei.doctype.task_template.task_template.get_all_task_template_from_sub_type',\n                        \t'args': {\n                                \t'sub_type':frm.doc.sub_type\n                        \t},\n                        \t'callback': function(res){\n\t\t\t\t\tvar tasks = cur_frm.doc.tasks;\n\t\t\t\t\tvar task_order = tasks.length + 1;\n\t\t\t\t\tres.message.forEach(function(element) {\n\t\t\t\t\t\tconsole.log(element.name);\n                    \t\t\t\tcur_frm.add_child(\"tasks\", {\n                        \t\t\t\t'title': element.name,\n                        \t\t\t\t'status': 'Open',\n                        \t\t\t\t'assigned_to': element.assigned_to,\n\t\t\t\t\t\t\t'task_order': task_order,\n\t\t\t\t\t\t\t'idx' : task_order\n                \t\t\t\t});\n\t\t\t\t\t\ttask_order++;\n                \t\t\t});\n\t\t\t\t\trefresh_field(\"tasks\"); \n               \t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\n/*\nfunction get_tasks_from_template(doc_name){\n        return function(){\n                frappe.call({\n\t\t\t\tmethod: \"shei.sheipy.get_tasks_from_template\",\n\t\t\t\targs: {\n\t\t\t\t\tproject_name: doc_name,\n\t\t\t\t},\n        \t    \t\tcallback: function(r) {    \n\t\t\t\t\trefresh_field(\"tasks\");                         \n        \t\t\t}\n\t\t\t});\n        }\n\n};*/", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2017-07-20 17:19:49.145028", 
  "name": "Purchase Invoice-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Purchase Invoice\", \"bill_date\", function(frm, cdt, cdn) {\n\tif (frm.doc.bill_date) {\n\t\tfrappe.call({\n\t\t\tmethod: \"shei.sheipy.get_due_date\",\n\t\t\targs:{\n\t\t\t\tsupplier: frm.doc.supplier,\n\t\t\t\tbill_date: frm.doc.bill_date\n\t\t\t},\n\t            \tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tcur_frm.set_value(\"due_date\", new Date(r.message));\n\t\t\t\t}\n\t        \t}\n\t\t});\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2017-07-29 02:06:26.296249", 
  "name": "Stock Entry-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Stock Entry\", \"refresh\", function(frm, cdt, cdn) {\n       \tfrm.add_custom_button(__(\"Get Items from Sales Order\"), function() {\n\t\tif (frm.doc.from_warehouse && frm.doc.to_warehouse && (frm.doc.purpose == \"Material Transfer\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"shei.sheipy.fetch_items_from_so\",\n\t\t\t\targs: {\n\t\t\t\t\tso: frm.doc.sales_order,\n\t\t\t\t},\n       \t    \t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Sales Order does not contain any stock item\"))\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each(r.message, function(item, value){\n\t\t\t\t\t\tvar d = frappe.model.add_child(cur_frm.doc, \"Stock Entry Detail\", \"items\");\n\t\t\t\t\t\td.item_code = item;\n\t\t\t\t\t\td.s_warehouse = frm.doc.from_warehouse;\n\t\t\t\t\t\td.t_warehouse = frm.doc.to_warehouse;\n\t\t\t\t\t\td.qty = value;\n\t\t\t\t\t\td.uom = 'Unit';\n\t\t\t\t\t\td.conversion_factor = 1;\n\t\t\t\t\t\td.transfer_qty = value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tfrm.refresh_field(\"items\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tmsgprint(\"From and To warehouses are mandatory and Purpose must be Material Transfer\");\n\t\t}\n\t});\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Terms and Conditions Multilingual Extension", 
  "modified": "2017-08-23 21:06:49.010750", 
  "name": "Terms and Conditions Multilingual Extension-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "//frappe.ui.form.on(\"Terms and Conditions Multilingual Extension\", \"refresh\", function(frm, cdt, cdn) {\n//        frm.add_custom_button(__(\"Update Terms on customer\"), function() {\n//\t\tfrappe.call({\n//\t\t\tmethod: \"shei.sheipy.update_terms\",\n//\t\t\targs: {\n//\t\t\t},\n//\t    \t\tcallback: function(r) {\n//      \t\t\t}\n//\t\t})\n//\t});\n//});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2019-08-19 13:57:16.869585", 
  "name": "Sales Order-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on('Sales Order', {\n    refresh: function(frm) {\n      frm.add_custom_button(__('Work Order'), function(){\n        var checked_items =  cur_frm.fields_dict.items.grid.get_selected_children().map(function(r){return r}); //list all checked instance\n\t\tfrappe.call({\n\t\t\tmethod: 'shei.events.create_work_order',\n\t\t\targs: {\n\t\t\t\tmfg_items : checked_items, \n\t\t\t\tso_name : frm.docname,\n\t\t\t},\n\t\t\tcallback: function() { }\n\t\t});\n\n    }, __(\"Make\"));\n    frm.add_custom_button(__('Latest Work Order'), function(){\n        var checked_items =  cur_frm.fields_dict.items.grid.get_selected_children().map(function(r){return r}); //list all checked instance\n\t\tfrappe.call({\n\t\t\tmethod: 'shei.events.update_work_order',\n\t\t\targs: {\n\t\t\t\tmfg_items : checked_items, \n\t\t\t\tso_name : frm.docname,\n\t\t\t\twork_order_name: cur_frm.doc.work_orders[cur_frm.doc.work_orders.length - 1].link_name,\n\t\t\t},\n\t\t\tcallback: function() { }\n\t\t});\n\n    }, __(\"Update\"));\n  }\n});\n\n/*frappe.ui.form.on('Sales Order', {\n\tcreate_work_order: function(frm) {\n\t\tvar checked_items =  cur_frm.fields_dict.items.grid.get_selected_children().map(function(r){return r}); //list all checked instance\n\t\tfrappe.call({\n\t\t\tmethod: 'shei.events.create_work_order',\n\t\t\targs: {\n\t\t\t\tmfg_items : checked_items, \n\t\t\t\tso_name : frm.docname,\n\t\t\t},\n\t\t\tcallback: function() { }\n\t\t});\n\t},\n});*/\n\n\nfrappe.ui.form.on(\"Sales Order\", \"customer\", function(frm, cdt, cdn) {\n\tfrappe.db.get_value(\"Customer\", frm.doc.customer, \"tc_name\", function(r){\n\t\tif(r.tc_name) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tc_name\", r.tc_name);\t\t\t\n\t\t}\n\t});\n\trefresh_field(\"tc_name\");\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier", 
  "modified": "2017-11-15 12:28:36.607694", 
  "name": "Supplier-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "$.extend(erpnext.utils, {\n        set_party_dashboard_indicators: function(frm){\n                if (frm.doc.__onload && frm.doc.__onload.dashboard_info){\n                        var info = frm.doc.__onload.dashboard_info;\n                        frm.dashboard.add_indicator(__('Last Year Billing: {0}',\n                                [format_currency(info.billing_last_year, info.currency)]), 'blue')\n\t\t\tfrm.dashboard.add_indicator(__('This Year Billing: {0}',\n                                [format_currency(info.billing_this_year, info.currency)]), 'blue')\n                        frm.dashboard.add_indicator(__('Total Unpaid: {0}',\n                                [format_currency(info.total_unpaid, info.currency)]),\n                                info.total_unpaid ? 'orange': 'green');\n                }\n        }\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Bank Account", 
  "modified": "2018-11-07 14:39:40.573606", 
  "name": "Bank Account-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on('Bank Account', 'refresh', function(frm){\n    frm.set_query('deposit_account', function(doc){\n    return {\n\t'filters': {\n        \t'company': frm.doc.company\n\t}\n    }\n})\n})", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2019-06-27 17:39:03.537978", 
  "name": "Delivery Note-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "/*frappe.ui.form.on('Crate Information', {\n    crate_gross_weight: function(frm, cdt, cdn){\n        var d = locals[cdt][cdn];\n        if (!d.crate_gross_weight) return;\n        frappe.model.set_value(cdt, cdn, 'crate_net_weight', d.crate_gross_weight - 100);\n    }\n});*/", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Address", 
  "modified": "2019-08-06 10:15:40.051751", 
  "name": "Address-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "frappe.ui.form.on(\"Address\", \"refresh\", function(frm, cdt, cdn) {\n\tif (frm.doc.__islocal){\n\t\tsetTimeout(function(){\n\t\tfrappe.model.set_value(cdt, cdn, \"country\", \"\");\n\t}, 1500);\n\t}\n});\n\n", 
  "script_type": "Client"
 }
]